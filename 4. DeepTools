#install DeepTools

conda install -c conda-forge -c bioconda deeptools

#or

pip install deeptools

#make sure to have .bai index files before proceeding
samtools index 1.bam

#convert .bam files to .bw

#sample 1
bamCoverage \
    -b 1.bam \
    -o 1.bw \
    --normalizeUsing CPM \
    --binSize 25 \
    --extendReads

#or all at once:
mkdir -p bigwigs
for b in sample*.bam; do
  out=bigwigs/$(basename ${b%.bam}.bw)
  bamCoverage -b $b -o $out \
    --normalizeUsing CPM \
    --binSize 50 \
    --effectiveGenomeSize 2913022398 \
    --extendReads --centerReads \
    --numberOfProcessors 4
done


multiBamSummary bins \
  --bamfiles 1.bam 2.bam 3.bam 4.bam 5.bam 6.bam 7.bam 8.bam \
  --binSize 10000 \
  --outFileName results/bam_summary_10kb.npz \
  --outRawCounts results/raw_counts_10kb.tab \
  --numberOfProcessors 4




#multiBamSummary
multiBamSummary bins \
  --bamfiles *.bam \
  --binSize 10000 \
  --outFileName bam_summary.npz \
  --outRawCounts raw_counts.tab
